{% extends "base.html" %}
{% load crispy_forms_tags %}


{% block content %}
<div class="book-detail" style="font-weight:300;">
  <div class="book-info border" style="height:100%;box-sizing:border-box;">
    <div class="cover p-1" style="height:50%">
      <img src="{{ book.cover.url }}" alt="{{ book.title }}" style="display:block;margin:0 auto;max-width:100%;max-height:100%;">
    </div>
    <div class="information text-center bg-dark text-white" style="height:50%">
      <p><b>Title: </b>{{ book.title }}</p>
      <p><b>Author: </b><a href="{% url 'author-detail' book.author.id %}">{{ book.author }}</a></p>
      <p><strong>ISBN:</strong> {{ book.isbn }}</p>
      <p><strong>Genre:</strong> {{ book.genre.all|join:", " }}</p>
      <p><mark><b><a href="{% url 'book-borrow' book.id %}" class="text-success text-lg">Click to borrow</a></b></mark></p>
    </div>
  </div>
  <div class="book-summary border p-3">
    <h1 class="text-center mt-1">Synopsis</h1>
    <div class="summary mt-3 p-4">
      {{ book.summary }}
    </div>
  </div>
  <div class="reviews border p-3">
    <div class="review-form">
      <h2 class="text-dark">Reviews</h2>
      <form class="mt-3" method="POST">
        {% csrf_token %}
        {{ form|crispy }}
        <input type="submit" value="Submit" class="btn text-white" style="background-color:#32CD30;">
      </form>
    </div>
    <div class="review-section">
      {% for post in book.bookreview_set.all %}
      <div class="review">
        <hr>
        <div class="text-dark mb-4">{{ post.review }}</div>
        <q cite="" style="display:block;" class="text-end text-info">{{ post.user }}</q>
        {% if post.user == user %}
        <div style="display:flex;justify-content:space-between;">
          <a href="{% url 'review-delete' post.id %}"><button type="button" name="button" class="btn btn-danger text-white">Delete</button></a>
          <span class="text-end text-secondary mb-2">{{ post.date }}</span>
        </div>
        {% else %}
        <p class="text-end text-secondary mb-2">{{ post.date }}</p>
        {% endif %}
        <hr>
      </div>
      {% endfor %}
    </div>
  </div>
  <div class="copies border p-3">
    <h2 class="text-info">Copies</h2>
    {% for copy in book.bookinstance_set.all %}
    <hr>
    <p class="{% if copy.status == 'a' %}text-success{% elif copy.status == 'm' %}text-danger{% else %}text-warning{% endif %}">
        {{ copy.get_status_display }}: {% if copy.status == 'o' %}<span>{{ copy.borrower }}</span>{% endif %}</p>

      {% if copy.status != 'a' %}
        <p><strong>Due to be returned:</strong> {{ copy.due_back }}</p>
      {% endif %}
      <p><strong>Imprint:</strong> {{ copy.imprint }}</p>
      <p class="text-muted"><strong>Id:</strong> {{ copy.id }}</p>
      {% endfor %}
  </div>
</div>
{% endblock content %}
